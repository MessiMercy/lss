



第一章：初识Nginx (19讲)


# 02 | Nginx适用于哪些场景？

![](../../pic/2020-05-13/2020-05-13-22-09-31.png)

备注：低效的Apache ，一个链接对应一个进程

# 04 | 为什么用Nginx：它的 5 个主要优点

- 1、高并发、高性能，高可靠，可扩展性好；
- 2、热部署；
- 3、bsd许可证；开源免费并且可以自己定制；



# 05 | Nginx的四个主要组成部分


- 1、二进制可执行文件：由各个源码模块编译出的一个文件；
- 2、nginx.config配置文件：控制nginx的行为；
- 3、access.log访问日志：记录每一条http请求；
- 4、error.log错误日志：定位问题；



# 07 | 选择哪一个Nginx发行版本？

tengine淘宝基于nginx进行二次开发而开源的web服务器项目。（不推荐）


- openresty基于Nginx二次开发的开源版本

http://openresty.org


# 09 | Nginx配置文件的通用语法介绍

![](../../pic/2020-10-02/2020-10-02-22-26-25.png)

![](../../pic/2020-10-02/2020-10-02-22-26-59.png)



htt配置的指令块：http、upstream、server、location；



语法示例：

```
http {
    upstream CashServers {
        server CashServers1.com;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://CashServers;        }
    }
}

```

![](../../pic/2020-10-02/2020-10-02-22-32-02.png)


# 10 | Nginx命令行及演示：重载、热部署、日志切割
# 11 | 用Nginx搭建一个可用的静态资源Web服务器
# 12 | 用Nginx搭建一个具备缓存功能的反向代理服务
# 13 | 用GoAccess实现可视化并实时监控access日志

基于websocket协议实时展示access.log中的内容。





# 14 | 从网络原理来看SSL安全协议

![](../../pic/2020-05-13/2020-05-13-22-35-04.png)


![](../../pic/2020-05-13/2020-05-13-22-35-46.png)


![](../../pic/2020-05-13/2020-05-13-22-36-47.png)





# 15 | 对称加密与非对称加密各自的应用场景
# 16 | SSL证书的公信力是如何保证的？
# 17 | SSL协议握手时Nginx的性能瓶颈在哪里？

![](../../pic/2020-05-13/2020-05-13-22-37-32.png)


# 18 | 用免费SSL证书实现一个HTTPS站点


# 19 | 基于OpenResty用Lua语言实现简单服务




第二章：Nginx架构基础 (22讲)

# 20 | Nginx的请求处理流程

![](../../pic/2020-05-13/2020-05-13-22-39-19.png)




# 21 | Nginx的进程结构

![](../../pic/2020-05-13/2020-05-13-22-39-53.png)

多进程模型而不是多多线程模型，如果是单进程多线程模型，因为进行内资源共享（地址空间），（第三方模块）一个线程错误导致整个进行挂掉；保证高可靠；

理论上worker进程的个数和机器的CPU个数一致，并且，可以把每个worker进行和对应的CPU绑定在一起，这也可以更好的利用CPU缓存来提升性能；




# 22 | Nginx的进程结构实例演示

基于信号完成和master进程的通信: - s

# 23 | 使用信号管理Nginx的父子进程

- 进程间通信：共享内存、信号等；
- 进程间管理：信号；


![](../../pic/2020-05-13/2020-05-13-22-40-41.png)

master进行启动worker进程；

备注：master进程的蓝色信号可以通过右侧Nginx命令行实现；


# 24 | reload重载配置文件的真相

![](../../pic/2020-05-13/2020-05-13-22-41-36.png)

# 25 | 热升级的完整流程

![](../../pic/2020-05-13/2020-05-13-22-42-17.png)

![](../../pic/2020-05-13/2020-05-13-22-42-54.png)

![](../../pic/2020-05-13/2020-05-13-22-43-19.png)

# 26 | 优雅地关闭worker进程

针对HTTP请求：


![](../../pic/2020-05-13/2020-05-13-22-43-55.png)


备注：针对tcp\udp以及websocket没法感知是否已经处理完请求；

# 27 | 网络收发与Nginx事件间的对应关系

![](../../pic/2020-05-13/2020-05-13-22-44-38.png)

![](../../pic/2020-05-13/2020-05-13-22-45-05.png)


![](../../pic/2020-05-13/2020-05-13-22-45-57.png)




# 28 | Nginx网络事件实例演示

![](../../pic/2020-10-03/2020-10-03-11-40-29.png)

针对三次握手使用wireshark抓包；


# 29 | Nginx的事件驱动模型

![](../../pic/2020-10-03/2020-10-03-11-55-21.png)



# 30 | epoll的优劣及原理

![各种网络模型性能对比](../../pic/2020-10-03/2020-10-03-12-15-49.png)

select\poll性能比较低，epoll取获取链接的时候只是获取激活的；

![](../../pic/2020-05-13/2020-05-13-22-47-04.png)

备注：添加、修改、删除对应的是红黑树的操作logN,获取句柄是遍历链表；

# 31 | Nginx的请求切换

![](../../pic/2020-05-13/2020-05-13-22-48-29.png)

备注：对比Apache多进程（一个进程处理一个请求），会发生多进程切换；

# 32 | 同步&异步、阻塞&非阻塞之间的区别

![](../../pic/2020-05-13/2020-05-13-22-49-29.png)

![](../../pic/2020-05-13/2020-05-13-22-50-07.png)


- 阻塞和非阻塞：底层来说；
- 同步和异步：调用编码方式；

# 33 | Nginx的模块究竟是什么？

- 1、前提：编译进Nginx
- 2、提供哪些配置项
- 3、模块何时被使用
- 4、提供哪些变量

![](../../pic/2020-10-03/2020-10-03-13-41-01.png)



# 34 | Nginx模块的分类

![](../../pic/2020-05-13/2020-05-13-22-51-46.png)


各个模块有一系列的子模块。

# 35 | Nginx如何通过连接池处理网络请求

![](../../pic/2020-10-03/2020-10-03-13-50-33.png)

worker_connections 512默认连接数；

如果作为反向代理服务器的话，一个链接会消耗两个链接；

![](../../pic/2020-10-03/2020-10-03-13-59-41.png)

一个链接消耗的内存：232+96*2（两个event事件消耗的内存）


# 36 | 内存池对性能的影响

- 链接内存池
- 请求内存池

# 37 | 所有worker进程协同工作的关键：共享内存

> 基础同步工具

- 信号
- 共享内存

> 高级通讯方式（解决共享内存引入的问题）

- 锁
- slab内存管理器

![](../../pic/2020-10-03/2020-10-03-14-11-52.png)


共享内存应用：系统流控；

# 38 | 用好共享内存的工具：Slab管理器



# 39 | 哈希表的max_size与bucket_size如何配置

nginx容器：数组、链表、队列、hash表、红黑树、基数树

![](../../pic/2020-05-13/2020-05-13-22-55-47.png)

![](../../pic/2020-10-03/2020-10-03-14-25-27.png)

# 40 | Nginx中最常用的容器：红黑树


![](../../pic/2020-05-13/2020-05-13-22-56-30.png)

![](../../pic/2020-05-13/2020-05-13-22-56-56.png)

![](../../pic/2020-10-03/2020-10-03-14-29-14.png)


# 41 | 使用动态模块来提升运维效率

![](../../pic/2020-10-03/2020-10-03-14-31-30.png)

第三章：详解HTTP模块 (40讲)

# 42 | 第三章内容介绍

# 43 | 冲突的配置指令以谁为准？

![配置块的嵌套](../../pic/2020-05-13/2020-05-13-22-58-06.png)


![指令的生效阶段](../../pic/2020-10-03/2020-10-03-14-39-51.png)



![](../../pic/2020-10-03/2020-10-03-16-21-33.png)

![](../../pic/2020-10-03/2020-10-03-16-22-26.png)

- 指令在哪个块下生效？
- 指令允许出现在哪些块下？
- 在server块内生效，从HTTP向server合并指令

# 44 | Listen指令的用法

![](../../pic/2020-10-03/2020-10-03-16-23-56.png)

# 45 | 处理HTTP请求头部的流程

![接收请求事件模块](../../pic/2020-10-03/2020-10-03-16-27-54.png)

![接收请求HTTP模块](../../pic/2020-10-03/2020-10-03-16-29-13.png)

![过大的请求头部](../../pic/2020-10-03/2020-10-03-16-30-10.png)

# 46 | Nginx中的正则表达式

![](../../pic/2020-10-03/2020-10-03-16-31-22.png)



# 47 | 如何找到处理请求的server指令块

![](../../pic/2020-10-03/2020-10-03-16-51-54.png)

# 48 | 详解HTTP请求的11个阶段

![匹配顺序](../../pic/2020-05-13/2020-05-13-23-00-45.png)


备注：对应处理过程中的HTTP模块中对应的模块；


# 49 | 11个阶段的顺序处理

![](../../pic/2020-10-03/2020-10-03-17-01-17.png)

# 50 | postread阶段：获取真实客户端地址的realip模块

![](../../pic/2020-05-13/2020-05-13-23-02-37.png)

![](../../pic/2020-10-03/2020-10-03-17-09-14.png)



# 51 | rewrite阶段的rewrite模块：return指令

![](../../pic/2020-10-03/2020-10-03-17-11-39.png)

![](../../pic/2020-10-03/2020-10-03-17-13-43.png)

![](../../pic/2020-10-03/2020-10-03-17-14-21.png)


# 52 | rewrite阶段的rewrite模块：重写URL


# 53 | rewrite阶段的rewrite模块：条件判断


# 54 | find_config阶段：找到处理请求的location指令块

![](../../pic/2020-10-03/2020-10-03-17-27-42.png)

# 55 | preaccess阶段：对连接做限制的limit_conn模块

![](../../pic/2020-10-03/2020-10-03-17-30-49.png)

![](../../pic/2020-10-03/2020-10-03-17-31-19.png)

![](../../pic/2020-10-03/2020-10-03-17-31-52.png)




# 56 | preaccess阶段：对请求做限制的limit_req模块

![](../../pic/2020-10-03/2020-10-03-17-35-00.png)


![](../../pic/2020-10-03/2020-10-03-17-35-54.png)

备注：应对突发流量；

![](../../pic/2020-10-03/2020-10-03-17-37-34.png)

![](../../pic/2020-10-03/2020-10-03-17-37-54.png)







# 57 | access阶段：对ip做限制的access模块

![](../../pic/2020-10-03/2020-10-03-17-42-21.png)


![](../../pic/2020-10-03/2020-10-03-17-42-46.png)




# 58 | access阶段：对用户名密码做限制的auth_basic模块


![](../../pic/2020-10-03/2020-10-03-17-44-53.png)

![](../../pic/2020-10-03/2020-10-03-17-45-11.png)

![](../../pic/2020-10-03/2020-10-03-17-45-50.png)

# 59 | access阶段：使用第三方做权限控制的auth_request模块

![](../../pic/2020-10-03/2020-10-03-17-48-02.png)



# 60 | access阶段的satisfy指令

![](../../pic/2020-10-03/2020-10-03-18-18-46.png)


# 61 | precontent阶段：按序访问资源的try_files模块

![](../../pic/2020-10-03/2020-10-03-18-21-03.png)


# 62 | 实时拷贝流量：precontent阶段的mirror模块

![](../../pic/2020-10-03/2020-10-03-18-23-07.png)

复制流量到测试环境

# 63 | content阶段：详解root和alias指令

![](../../pic/2020-10-03/2020-10-03-18-25-51.png)





# 64 | static模块提供的3个变量

![](../../pic/2020-10-03/2020-10-03-18-33-44.png)

![](../../pic/2020-10-03/2020-10-03-18-34-00.png)

# 65 | static模块对url不以斜杠结尾却访问目录的做法







# 66 | index和autoindex模块的用法

# 67 | 提升多个小文件性能的concat模块

# 68 | access日志的详细用法

![](../../pic/2020-10-03/2020-10-03-18-38-04.png)

![](../../pic/2020-10-03/2020-10-03-18-38-59.png)


![](../../pic/2020-10-03/2020-10-03-18-41-01.png)




# 69 | HTTP过滤模块的调用流程

![](../../pic/2020-05-13/2020-05-13-23-05-20.png)


对响应做处理

![](../../pic/2020-10-03/2020-10-03-18-43-40.png)


# 70 | 用过滤模块更改响应中的字符串：sub模块

![](../../pic/2020-10-03/2020-10-03-18-44-46.png)



# 71 | 用过滤模块在http响应的前后添加内容：addition模块

![](../../pic/2020-10-03/2020-10-03-18-46-10.png)

# 72 | Nginx变量的运行原理

![](../../pic/2020-10-03/2020-10-03-18-53-09.png)

![](../../pic/2020-10-03/2020-10-03-18-55-07.png)

# 73 | HTTP框架提供的请求相关的变量

![](../../pic/2020-10-03/2020-10-03-18-54-12.png)

![](../../pic/2020-10-03/2020-10-03-18-59-01.png)

![](../../pic/2020-10-03/2020-10-03-18-59-26.png)

![](../../pic/2020-10-03/2020-10-03-18-59-50.png)

![](../../pic/2020-10-03/2020-10-03-19-00-51.png)

![](../../pic/2020-10-03/2020-10-03-19-01-39.png)

![](../../pic/2020-10-03/2020-10-03-19-02-42.png)

![](../../pic/2020-10-03/2020-10-03-19-03-23.png)

![](../../pic/2020-10-03/2020-10-03-19-04-35.png)

![](../../pic/2020-10-03/2020-10-03-19-04-56.png)

![](../../pic/2020-10-03/2020-10-03-19-05-16.png)

![](../../pic/2020-10-03/2020-10-03-19-05-37.png)





# 74 | HTTP框架提供的其他变量


# 75 | 使用变量防盗链的referer模块

![](../../pic/2020-10-03/2020-10-03-19-06-24.png)


# 76 | 使用变量实现防盗链功能实践：secure_link模块


# 77 | 为复杂的业务生成新的变量：map模块


# 78 | 通过变量指定少量用户实现AB测试：split_client模块


# 79 | 根据IP地址范围的匹配生成新变量：geo模块


# 80 | 使用变量获得用户的地理位置：geoip模块


# 81 | 对客户端使用keepalive提升连接效率

![](../../pic/2020-10-03/2020-10-03-19-11-47.png)

![](../../pic/2020-10-03/2020-10-03-19-12-28.png)

第四章：反向代理与负载均衡 (38讲)

# 82 | 反向代理与负载均衡原理

![](../../pic/2020-05-13/2020-05-13-23-06-58.png)

![](../../pic/2020-10-03/2020-10-03-19-16-42.png)

![](../../pic/2020-10-03/2020-10-03-19-17-33.png)


# 83 | 负载均衡策略：round-robin

![](../../pic/2020-10-03/2020-10-03-19-19-33.png)

![](../../pic/2020-10-03/2020-10-03-19-19-56.png)


![](../../pic/2020-10-03/2020-10-03-19-20-39.png)

![](../../pic/2020-10-03/2020-10-03-19-22-18.png)




# 84 | 负载均衡哈希算法：ip_hash与hash模块

![](../../pic/2020-10-03/2020-10-03-20-43-22.png)

![](../../pic/2020-10-03/2020-10-03-20-43-44.png)


# 85 | 一致性哈希算法：hash模块

![](../../pic/2020-10-03/2020-10-03-20-46-57.png)

# 86 | 最少连接算法以及如何跨worker进程生效

![](../../pic/2020-10-03/2020-10-03-20-50-20.png)

![](../../pic/2020-10-03/2020-10-03-20-51-33.png)

![](../../pic/2020-10-03/2020-10-03-20-52-59.png)



# 87 | upstream模块提供的变量



# 88 | proxy模块处理请求的流程

![](../../pic/2020-10-03/2020-10-03-21-01-01.png)

Nginx和上游服务会处于一个网络中。

# 89 | proxy模块中的proxy_pass指令

![](../../pic/2020-10-03/2020-10-03-21-01-31.png)

![](../../pic/2020-10-03/2020-10-03-21-01-58.png)


# 90 | 根据指令修改发往上游的请求



# 91 | 接收用户请求包体的方式

![](../../pic/2020-10-03/2020-10-03-21-10-03.png)

# 92 | 与上游服务建立连接

![tcp握手耗时](../../pic/2020-10-03/2020-10-03-21-14-21.png)

![](../../pic/2020-10-03/2020-10-03-21-14-51.png)

![](../../pic/2020-10-03/2020-10-03-21-15-07.png)



# 93 | 接收上游的响应

![](../../pic/2020-10-03/2020-10-03-21-21-01.png)




# 94 | 处理上游的响应头部


# 95 | 上游出现失败时的容错方案


# 96 | 对上游使用SSL连接


# 97 | 用好浏览器的缓存


# 98 | Nginx决策浏览器过期缓存是否有效


# 99 | 缓存的基本用法


# 100 | 对客户端请求的缓存处理流程


# 101 | 接收上游响应的缓存处理流程


# 102 | 如何减轻缓存失效时上游服务的压力
# 103 | 及时清除缓存
# 104 | uwsgi、fastcgi、scgi指令的对照表
# 105 | memcached反向代理的用法
# 106 | 搭建websocket反向代理
# 107 | 用分片提升缓存效率
# 108 | open file cache提升系统性能
# 109 | HTTP/2协议介绍

![](../../pic/2020-05-13/2020-05-13-23-09-44.png)


110 | 搭建HTTP/2服务并推送资源
111 | gRPC反向代理
112 | stream四层反向代理的7个阶段及常用变量
113 | proxy protocol协议与realip模块
114 | 限并发连接、限IP、记日志
115 | stream四层反向代理处理SSL下游流量
116 | stream_preread模块取出SSL关键信息
117 | stream proxy四层反向代理的用法
118 | UDP反向代理
119 | 透传IP地址的3个方案
第五章：Nginx的系统层性能优化 (18讲)

120 | 性能优化方法论

![](../../pic/2020-05-13/2020-05-13-23-11-48.png)

121 | 如何高效使用CPU
122 | 多核间的负载均衡
123 | 控制TCP三次握手参数

![](../../pic/2020-05-13/2020-05-13-23-14-50.png)


![](../../pic/2020-05-13/2020-05-13-23-16-08.png)






124 | 建立TCP连接的优化
125 | 滑动窗口与缓冲区

![](../../pic/2020-05-13/2020-05-13-23-17-07.png)


![](../../pic/2020-05-13/2020-05-13-23-17-46.png)

![](../../pic/2020-05-13/2020-05-13-23-17-56.png)


![](../../pic/2020-05-13/2020-05-13-23-19-27.png)

126 | 优化缓冲区与传输效率
127 | 慢启动与拥塞窗口
128 | TCP协议的keepalive功能
129 | 减少关闭连接时的time_wait端口数量
130 | lingering_close延迟关闭TCP连接
131 | 应用层协议的优化
132 | 磁盘IO的优化
133 | 减少磁盘读写次数
134 | 零拷贝与gzip_static模块
135 | 用tcmalloc优化内存分配
136 | 使用Google PerfTools分析Nginx
137 | 使用stub_status模块监控Nginx的状态
第六章：从源码视角深入使用Nginx与OpenResty (18讲)

138 | 第三方模块源码的阅读
139 | Nginx的启动流程
140 | HTTP第三方模块的初始化
141 | if指令是邪恶的吗？
142 | 解读Nginx的核心转储文件
143 | 通过debug日志定位问题
144 | OpenResty概述
145 | OpenResty中的Nginx模块与Lua模块
146 | 如何在Nginx中嵌入Lua代码
147 | OpenResty中Lua与C代码交互的原理
148 | 获取、修改请求与响应的SDK
149 | 工具类型的SDK
150 | 同步且非阻塞的底层SDK：cosocket
151 | 基于协程的并发编程SDK
152 | 定时器及时间相关的SDK
153 | share.DICT基于共享内存的字典
154 | 子请求的使用方法
155 | 基于OpenResty的WAF防火墙
































